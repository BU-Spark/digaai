<!DOCTYPE html>
<!-- saved from url=(0058)https://newsignature.github.io/us-map/#usage-style-options -->
<html class="js no-flexbox canvas canvastext webgl touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths gr__newsignature_github_io" lang="en"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Digaii - </title>
  <meta name="description" content="">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->



<body data-gr-c-s-loaded="true">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/style2.css" />



<div id="navbar" class="navbar">
    <div id="dropdown" class="dropdown">
        <button class="dropbtn" onclick="dropDown()"> Features
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content" id="selectFeature">
        </div>
    </div> 
</div>


<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-queue.v3.min.js"></script>


</script><script src="./js/variables.js"></script>   
  <header id="overview" class="overview">
    <div class="container-fluid">
      <div class="row-fluid clearfix">
  
  <div role="main" class="container-fluid multiarticles">
    <article id="demo">
      <header class="page-header">
	  <h1>Demo for Digaii</h1>
	  <h2><small>Click on the state to see the result</small></h2>
	  </header>
        <div class="row-fluid">
          <div class="span6">
            <div class="example">
              <div class="results">
                <h5>Results</h5>
                <div id="clicked-state">Click on a state</div></div>
              <div class="map" id="map"><svg height="0" version="1.1" width="0" xmlns="http://www.w3.org/2000/svg"
			  style="overflow: hidden; position: relative; top: 0.75px;" viewBox="0 0 1030 630" preserveAspectRatio="xMinYMin">
			  </div>
          </div>
        </div>
    </article>
  <!-- JavaScript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <script src="./js/jquery.min.js.download"></script>
  <script>window.jQuery</script>

  <!-- scripts concatenated and minified via build script -->
  <script src="./js/bootstrap.js.download"></script>
  <script src="./js/raphael.js.download"></script>
  <script src="./js/jquery.usmap.js.download"></script>
    <div class="window">
        <svg id="map" width="960" height="600"></svg>
        <div class="chart">
            <svg id="bar" width="480" height = "300"></svg>
            <svg id="pie" width="480" height = "350"></svg>
        </div>
    </div>
  
  <script>
    var chartData = null;
  
    var barSvg = d3.select("#bar"),
        barMargin = {top: 20, right: 50, bottom: 100, left: 100},
        barWidth = +barSvg.attr("width") - barMargin.left - barMargin.right,
        barHeight = +barSvg.attr("height") - barMargin.top - barMargin.bottom;

    var pieSvg = d3.select("#pie"),
        pieMargin = {top: 0, right: 0, bottom: 100, left: 0},
        pieWidth = +pieSvg.attr("width") - pieMargin.left - pieMargin.right,
        pieHeight = +pieSvg.attr("height") - pieMargin.top - pieMargin.bottom,
        pieRadius = Math.min(pieWidth, pieHeight) / 2;


  
	function getGroup(Cdata, group, changeFeature = false) {
        start = 0;
        end = 0;
        console.log(Cdata)
        switch(group) {
            case "population": start = 0; end = 1;
                break;
            case "age detail": start = 1; end = 19;
                break;
            case "age summary": start = 19; end = 23;
                break;
            case "gender": start = 23; end = 25;
                break;
            case "marriage": start = 25; end = 30;
                break;
            case "citizen": start = 30; end = 32;
                break;
            case "enter time": start = 32; end = 34;
                break;
            case "education": start = 34; end = 37;
                break;
            case "civilian labor force": start = 37; end = 39;
                break;
            case "unemployed": start = 39; end = 41;
                break;
            case "employment type": start = 41; end = 45;
                break;
            case "employment by industry": start = 45; end = 52;
                break;
            case "employment by occupation": start = 52; end = 60;
                break;
            case "income": start = 60; end = 63;
                break;
        }
        if(changeFeature)
            currFeature = d3.min([d3.max([start, currFeature]), end - 1]);

        return Cdata.slice(start, end);
    }

    // util functions 
    function rowMax(data) {
        m = -Infinity;
        for(var k in data) {
            if(k) {
                v = data[k];
                if(m < v) m = v;
            }
        }
        return m;
    }

    function columnMax(group, state) {
        m = -Infinity;
        for(i = 0; i < group.length; ++i) {
            v = group[i][state];
            if(m < v) m = v;
        }
        return m;
    }

    
    d3.csv("http://aaell.me/resources/all_data.csv",
        function(datacsv) {
            var all_data = datacsv;
            console.log(datacsv[0]);
            chartData = dataPreprocess(all_data);
            showBarChart(chartData);
            console.log("finished")
        }
    );
    var currState = 'OK';
    var stateToInt = {
      'OK': "01",
      'MA': "02",
      'WA': "03",
      'CA': "04"       //01,02,04,05,06,08,09,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,44,45,46,47,48,49,50,51,53,54,55,56
    };    
    
    $('body').scrollspy({offset: $('#nav').outerHeight()+10, target: '#nav'})
    $('body')
      .on('click', 'a', function(event) {
        var link = $(event.target);
        var toElement = $(link.attr('href'));
        if(toElement.length) {
          var top = toElement.offset().top - $('#nav').outerHeight();
          $('html, body').animate({scrollTop: top}, 1000);
        }
      });
      
	function showBarChart(cData) {
		// clean last output
		barSvg.select("g").remove();
		if(currGroup === "population") return;

		var currData = getGroup(cData, currGroup);
        console.log(currData)

		x = d3.scaleBand().rangeRound([0, barWidth]).padding(0.1),
		y = d3.scaleLinear().rangeRound([barHeight, 0]);

		x.domain(currData.map(d => d[""]));
		y.domain([0, columnMax(currData, stateToInt[currState])]);
        function funcForY(d){
            return y(d[stateToInt[currState]]);
        }
        function funcForH(d){
             return barHeight - y(d[stateToInt[currState]]);
        }
        

		let g = barSvg.append("g")
						.attr("transform", "translate(" + barMargin.left + "," + barMargin.top + ")");
        console.log("checkpoint3")

		g.append("g")
			.attr("transform", "translate(0," + barHeight + ")")
			.call(d3.axisBottom(x))
			.selectAll("text")
			.attr("y", 0)
			.attr("x", 9)
			.attr("dy", ".35em")
			.attr("transform", "rotate(90)")
			.style("text-anchor", "start");
        console.log("checkpoint4")

		g.append("g")
			.call(d3.axisLeft(y))
			.append("text")
			.attr("transform", "rotate(-90)")
			.attr("y", 6)
			.attr("dy", "0.71em")
			.attr("text-anchor", "end")
			.text("Frequency");
        console.log("checkpoint5")
            
		g.selectAll(".bar")
			.data(currData)
			.enter().append("rect")
			.attr("class", "bar")
			.attr("x", d => x(d[""])) 
			.attr("y", funcForY) //error here
			.attr("width", x.bandwidth())
			.attr("height", funcForH) //error here
        console.log("checkpoint6")
			//.on("click", clickFeature)
			//.on("mouseover", barTip.show)
			//.on("mouseout", barTip.hide);
            
	}
    function clickFeature(d, i) {
        //todo
        console.log('clickFeature');
    }
      
	  	  
    function dataPreprocess(dataPre) {
		rst = {};
		for(i = 0; i < dataPre.length; ++i) {
			for(var k in dataPre[i]) {
				if(k) {
					numStr = dataPre[i][k].replace(/[,$ ]/g, '');
					dataPre[i][k] = parseFloat(numStr);
				} 
			}
		}
		return dataPre;
	}
      
        
    $('#map').usmap({
      'stateStyles': {
        fill: "#4ECDC4",
        stroke: "#41A59B",
        "stroke-width": 1,
        "stroke-linejoin": "round",
        scale: [1, 1]
      },
      'stateHoverStyles': {
        fill: "#C7F464",
        stroke: "#ADCC56",
        scale: [1.1, 1.1]
      },
      'labelBackingStyles': {
        fill: "#4ECDC4",
        stroke: "#41A59B",
        "stroke-width": 1,
        "stroke-linejoin": "round",
        scale: [1, 1]
      },
      
      // The styles for the hover
      'labelBackingHoverStyles': {
        fill: "#C7F464",
        stroke: "#ADCC56",
      },
      'labelTextStyles': {
      fill: "#222",
        'stroke': 'none',
        'font-weight': 300,
        'stroke-width': 0,
        'font-size': '10px'
      },
      click: function(event, data) {
		currState = data.name;
        $('#clicked-state').text('You clicked: '+currState+' AND '+currGroup);
        if (!(chartData===null)){
            showBarChart(chartData);
        }
        else{
            console.log("null chartData")
        }

      }
    });
  </script>
</body>

